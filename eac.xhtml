<?xml version="1.0" encoding="utf-8"?>
<!--
    Copyright (C) 2012 Ethan Gruber
    xEAC: https://github.com/ewg118/xEAC
    Apache License 2.0
-->
<xhtml:html xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:ev="http://www.w3.org/2001/xml-events"
	xmlns:xxforms="http://orbeon.org/oxf/xml/xforms" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:fr="http://orbeon.org/oxf/xml/form-runner" xmlns:xeac="https://github.com/ewg118/xEAC"
	xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xxi="http://orbeon.org/oxf/xml/xinclude" xmlns:eac="urn:isbn:1-931666-33-4" xmlns="urn:isbn:1-931666-33-4"
	xmlns:xxbl="http://orbeon.org/oxf/xml/xbl" xmlns:pipeline="java:org.orbeon.oxf.processor.pipeline.PipelineFunctionLibrary" xmlns:exf="http://www.exforms.org/exf/1-0"
	xmlns:saxon="http://saxon.sf.net/" xmlns:oxf="http://www.orbeon.com/oxf/processors" xmlns:xbl="http://www.w3.org/ns/xbl">
	<xhtml:head>
		<xhtml:title>xEAC: Edit EAC-CPF Record</xhtml:title>
		<link rel="stylesheet" type="text/css" href="/apps/xeac/css/grids-min.css"/>
		<link rel="stylesheet" type="text/css" href="/apps/xeac/css/reset-fonts-grids.css"/>
		<link rel="stylesheet" type="text/css" href="/apps/xeac/css/base-min.css"/>
		<link rel="stylesheet" type="text/css" href="/apps/xeac/css/fonts-min.css"/>
		<!-- xeac styling -->
		<link rel="stylesheet" href="/apps/xeac/css/style.css"/>
		<link rel="stylesheet" href="/apps/xeac/css/themes/smoothness.css"/>
		<script type="text/javascript" src="/apps/xeac/javascript/jquery-1.4.2.min.js"/>
		<script type="text/javascript" src="/apps/xeac/javascript/menu.js"/>

		<xforms:model>
			<xs:schema elementFormDefault="qualified" attributeFormDefault="unqualified">
				<xs:simpleType name="iso8601date">
					<xs:restriction base="xs:string">
						<xs:pattern
							value="(\-?(0|1|2)([0-9]{3})(((01|02|03|04|05|06|07|08|09|10|11|12)((0[1-9])|((1|2)[0-9])|(3[0-1])))|\-((01|02|03|04|05|06|07|08|09|10|11|12)(\-((0[1-9])|((1|2)[0-9])|(3[0-1])))?))?)"
						/>
					</xs:restriction>
				</xs:simpleType>
			</xs:schema>

			<!-- ******************* INSTANCES ****************** -->
			<xforms:instance id="doc">
				<eac-cpf xmlns="urn:isbn:1-931666-33-4" xmlns:owl="http://www.w3.org/2002/07/owl#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:xlink="http://www.w3.org/1999/xlink">
					<control>
						<recordId/>
						<maintenanceAgency>
							<agencyName/>
						</maintenanceAgency>
						<maintenanceHistory>
							<maintenanceEvent>
								<eventType>created</eventType>
								<eventDateTime standardDateTime=""/>
								<agentType>human</agentType>
								<agent/>
							</maintenanceEvent>
						</maintenanceHistory>
						<maintenanceStatus>new</maintenanceStatus>
					</control>
					<cpfDescription>
						<identity>
							<entityType/>
							<nameEntry>
								<part/>
							</nameEntry>
						</identity>
						<relations/>
					</cpfDescription>
				</eac-cpf>
			</xforms:instance>

			<!-- exist URL is stored in an XML file -->
			<xforms:instance id="exist-url">
				<xi:include href="exist-url.xml"/>
			</xforms:instance>

			<xforms:instance id="config">
				<config xmlns=""/>
			</xforms:instance>
			
			<xforms:instance id="status">
				<status xmlns=""/>
			</xforms:instance>

			<!--  *** controlled vocabulary lists *** -->
			<xforms:instance id="maintenanceStatus-list">
				<list xmlns="">
					<item>cancelled</item>
					<item>deleted</item>
					<item>deletedReplaced</item>
					<item>deletedSplit</item>
					<item>derived</item>
					<item>new</item>
					<item>revised</item>
				</list>
			</xforms:instance>

			<xforms:instance id="eventType-list">
				<list xmlns="">
					<item>cancelled</item>
					<item>created</item>
					<item>deleted</item>
					<item>derived</item>
					<item>revised</item>
					<item>updated</item>
				</list>
			</xforms:instance>

			<xforms:instance id="agentType-list">
				<list xmlns="">
					<item>human</item>
					<item>machine</item>
				</list>
			</xforms:instance>

			<xforms:instance id="entityType-list">
				<list xmlns="">
					<item>corporateBody</item>
					<item>person</item>
					<item>family</item>
				</list>
			</xforms:instance>

			<!-- ******************* EAC ELEMENTS ****************** -->
			<!-- control -->
			<xforms:instance id="maintenanceEvent-template">
				<maintenanceEvent>
					<eventType/>
					<eventDateTime standardDateTime=""/>
					<agentType>human</agentType>
					<agent/>
				</maintenanceEvent>
			</xforms:instance>

			<!-- cpfDescription -->
			<xforms:instance id="description-template">
				<description/>
			</xforms:instance>

			<xforms:instance id="relations-template">
				<relations/>
			</xforms:instance>

			<!-- identity -->
			<xforms:instance id="nameEntry-template">
				<nameEntry>
					<part/>
				</nameEntry>
			</xforms:instance>

			<xforms:instance id="nameEntryParallel-template">
				<nameEntryParallel/>
			</xforms:instance>

			<xforms:instance id="entityId-template">
				<entityId/>
			</xforms:instance>

			<xforms:instance id="descriptiveNote-template">
				<descriptiveNote/>
			</xforms:instance>

			<!-- relations -->
			<xforms:instance id="cpfRelation-template">
				<cpfRelation xlink:type="simple">
					<relationEntry/>
				</cpfRelation>
			</xforms:instance>
			
			<!-- ******************* SOLR INSTANCES ****************** -->
			<!-- send to Solr -->
			<xforms:instance id="addIndex">
				<add xmlns=""/>
			</xforms:instance>
			
			<!-- Instance for Solr commit-->
			<xforms:instance id="sendCommit">
				<commit/>
			</xforms:instance>


			<!-- ******************* BINDINGS ****************** -->
			<xforms:bind id="control-tab" nodeset="instance('doc')/eac:control"/>
			<xforms:bind id="identity-tab" nodeset="instance('doc')/eac:cpfDescription/eac:identity"/>
			<xforms:bind id="description-tab" nodeset="instance('doc')/eac:cpfDescription/eac:description"/>
			<xforms:bind id="relations-tab" nodeset="instance('doc')/eac:cpfDescription/eac:relations"/>

			<xforms:bind nodeset="instance('doc')">
				<xforms:bind nodeset="eac:control">
					<xforms:bind nodeset="eac:recordId" required="true()"/>
					<xforms:bind nodeset="eac:maintenanceStatus" constraint="string-length(.) &gt; 0"/>
					<xforms:bind nodeset="eac:maintenanceHistory">
						<xforms:bind nodeset="eac:maintenanceEvent">
							<xforms:bind nodeset="eac:eventType" required="true()"/>
							<xforms:bind nodeset="eac:eventDateTime">
								<xforms:bind nodeset="@standardDateTime" type="xs:dateTime" required="true()"/>
							</xforms:bind>
							<xforms:bind nodeset="eac:agentType" required="true()"/>
						</xforms:bind>
					</xforms:bind>
				</xforms:bind>
				<xforms:bind nodeset="eac:cpfDescription">
					<!-- set content for dates anywhere -->
					<xforms:bind nodeset="descendant::*/@standardDate" type="iso8601date" required="true()"/>
					<xforms:bind nodeset="eac:identity">
						<xforms:bind nodeset="eac:entityType" required="true()"/>
						<xforms:bind nodeset="eac:nameEntry">
							<xforms:bind nodeset="eac:part" required="true()"/>
						</xforms:bind>
					</xforms:bind>
					<xforms:bind nodeset="eac:relations">
						<xforms:bind nodeset="descendant::eac:relationEntry" required="true()"/>
					</xforms:bind>
				</xforms:bind>
			</xforms:bind>

			<!-- ******************* SUBMISSIONS ****************** -->
			<!-- load preliminary instances -->
			<xforms:submission id="load-config" serialization="none" method="get" action="{instance('exist-url')}xeac/config.xml" replace="instance" instance="config"/>

			<!-- Submission to get the document -->
			<xforms:submission id="load-doc" serialization="none" method="get" action="{instance('exist-url')}xeac/records/{instance('doc')/eac:control/eac:recordId}.xml" replace="instance"
				instance="doc" xxforms:username="admin" xxforms:password="">
				<xforms:message ev:event="xforms-submit-error" level="modal">Unable to load finding aid</xforms:message>
				<xforms:send submission="load-toc" ev:event="xforms-submit-done"/>
			</xforms:submission>

			<!-- Submission to save the document -->
			<xforms:submission id="save-doc" ref="instance('doc')" action="{instance('exist-url')}xeac/records/{instance('doc')/eac:control/eac:recordId}.xml" method="put" replace="none"
				xxforms:username="admin" xxforms:password="">
				<xforms:message ev:event="xforms-submit-error" level="modal">Error Saving Documents. Be sure all required inputs are filled in.</xforms:message>
				<xforms:action ev:event="xforms-submit-done">
					<xforms:setvalue ref="instance('status')">EAC record saved.</xforms:setvalue>
					<!-- post to Solr unpublished core -->
					<xforms:insert nodeset="instance('addIndex')" origin="xxforms:call-xpl('oxf:/apps/xeac/xpl/eac-to-solr-all.xpl', 'data', instance('doc'), 'data')"/>
					<xforms:send submission="post-to-all"/>
					<!-- check to see if the document is already published to Solr -->
					<!--<xforms:send submission="query-solr-for-publication"/>-->					
				</xforms:action>
			</xforms:submission>

			<!-- submission to query solr to see if the document is published -->
			<xforms:submission id="query-solr-for-publication" serialization="none" method="get" action="{instance('config')/solr_published}select/?q=id:{instance('doc')/eac:control/eac:recordId}"
				replace="instance" instance="is-published">
				<!-- if the document is found in solr, get the updated solr doc -->
				<xforms:send ev:event="xforms-submit-done" if="instance('is-published')/result[@name='response']/@numFound = '1'" submission="ead-publish"/>
			</xforms:submission>
			<!-- access service to read in pre-transformed solr doc -->
			<xforms:submission id="eac-publish" method="get" replace="instance" instance="addIndex" serialization="none" resource="/xeac/solr/{instance('doc')/eac:control/eac:recordId}">
				<xforms:message ev:event="xforms-submit-error" level="modal">Error transforming EAC record to Solr document.</xforms:message>
				<xforms:send ev:event="xforms-submit-done" submission="publish-submission"/>
			</xforms:submission>

			<!-- post instance to Solr -->
			<xforms:submission id="publish-submission" action="{instance('config')/solr_published}update" ref="instance('addIndex')" instance="addIndex" replace="instance" method="post">
				<xforms:send ev:event="xforms-submit-done" submission="submit-commit"/>
				<xforms:setvalue ev:event="xforms-submit-done" ref="instance('status')">EAC record saved and updated to search index.</xforms:setvalue>
				<xforms:message ev:event="xforms-submit-error" level="modal">Data Failed to POST to Solr. Index may be offline or URL is incorrect.</xforms:message>
			</xforms:submission>
			
			<!-- send commit -->			
			<xforms:submission id="submit-commit" action="{instance('config')/solr_published}update" ref="instance('sendCommit')" instance="sendCommit" replace="none" method="post"/>

			<!-- for unpublished documents, always save to unpublished core -->
			<!-- post instance to Solr -->
			<xforms:submission id="post-to-all" action="{instance('config')/solr_all}update" ref="instance('addIndex')" instance="addIndex" replace="instance" method="post">
				<xforms:send ev:event="xforms-submit-done" submission="submit-all-commit"/>
				<xforms:setvalue ev:event="xforms-submit-done" ref="instance('status')">EAC record saved.</xforms:setvalue>
				<xforms:message ev:event="xforms-submit-error" level="modal">Data Failed to POST to Solr. Index may be offline or URL is incorrect.</xforms:message>
			</xforms:submission>

			<!-- send commit -->
			<xforms:submission id="submit-all-commit" action="{instance('config')/solr_all}update" ref="instance('sendCommit')" instance="sendCommit" replace="none" method="post"/>

			<!-- ************************ xforms-model-construct-done ****************************** -->
			<!-- load recordId -->
			<xforms:action ev:event="xforms-model-construct-done">
				<xforms:send submission="load-config"/>
				<!-- if there is a recordId parameter, load existing EAC record -->
				<xforms:action if="string(xxforms:get-request-parameter('recordId'))">
					<xforms:setvalue ref="instance('doc')/eac:control/eac:recordId" value="xxforms:get-request-parameter('recordId')"/>
					<xforms:send submission="load-doc"/>
				</xforms:action>
				<xforms:action if="not(string(xxforms:get-request-parameter('recordId')))">
					<xforms:setvalue ref="instance('doc')/eac:control/eac:maintenanceHistory/eac:maintenanceEvent/eac:eventDateTime/@standardDateTime" value="current-dateTime()"/>
					<!--<xforms:send submission="load-eac-template"/>-->
				</xforms:action>				
			</xforms:action>
			
			<xforms:action ev:event="xforms-ready">
				<xforms:dispatch targetid="temp-tab" name="fr-toggle"/>
			</xforms:action>
		</xforms:model>

		<!-- XBL components -->
		<xi:include href="oxf:/xbl/xeac/cpfRelation/cpfRelation.xbl" xi:omit-xml-base="true"/>
		<xi:include href="oxf:/xbl/xeac/date/date.xbl" xi:omit-xml-base="true"/>
		<xi:include href="oxf:/xbl/xeac/dateRange/dateRange.xbl" xi:omit-xml-base="true"/>
		<xi:include href="oxf:/xbl/xeac/dateSet/dateSet.xbl" xi:omit-xml-base="true"/>
		<xi:include href="oxf:/xbl/xeac/nameEntry/nameEntry.xbl" xi:omit-xml-base="true"/>
		<xi:include href="oxf:/xbl/xeac/placeEntry/placeEntry.xbl" xi:omit-xml-base="true"/>
		<xi:include href="oxf:/xbl/xeac/relation/relation.xbl" xi:omit-xml-base="true"/>
		<xi:include href="oxf:/xbl/xeac/relationEntry/relationEntry.xbl" xi:omit-xml-base="true"/>
		<xi:include href="oxf:/xbl/xeac/useDates/useDates.xbl" xi:omit-xml-base="true"/>
	</xhtml:head>

	<xhtml:body class="yui-skin-sam">
		<div id="doc4" class="yui-t2">
			<!-- header -->
			<xxforms:variable name="display_path">../../</xxforms:variable>
			<!--<xi:include href="header-admin.xml"/>-->
			<div id="bd">
				<xforms:group ref="instance('status')/text()">
					<div class="success">
						<xforms:output ref="instance('status')"/>
					</div>
				</xforms:group>
				<p>
					<a href="../../">&lt; Return</a>
				</p>
				<div id="yui-main">
					<div id="form">
						<div class="submission">
							<xforms:submit submission="save-doc" appearance="minimal">
								<xforms:label><img src="/apps/xeac/images/save.gif" alt="Save"/>Save</xforms:label>
							</xforms:submit>
							<xforms:submit submission="load-doc" appearance="minimal">
								<xforms:label><img src="/apps/xeac/images/recycle-green.png" alt="Revert"/>Load</xforms:label>
							</xforms:submit>
						</div>
						<div class="section">
							<h1>Edit EAC-CPF Record</h1>
							<div class="trigger_container">
								<xforms:group ref="instance('doc')[count(eac:cpfDescription/eac:description) = 0]">
									<xforms:trigger appearance="minimal">
										<xforms:label>
											<img src="{$display_path}images/add.gif"/>Description</xforms:label>
										<xforms:insert ev:event="DOMActivate" context="instance('doc')/eac:cpfDescription" origin="instance('description-template')" nodeset="eac:identity"
											position="after"/>
									</xforms:trigger>
								</xforms:group>
								<xforms:group ref="instance('doc')[count(eac:cpfDescription/eac:relations) = 0]">
									<xforms:trigger appearance="minimal">
										<xforms:label>
											<img src="{$display_path}images/add.gif"/>Relations</xforms:label>
										<xforms:insert ev:event="DOMActivate" context="instance('doc')/eac:cpfDescription" origin="instance('relations-template')" nodeset="./child::node()[last()]"/>
									</xforms:trigger>
								</xforms:group>
							</div>
							<div>
								<xforms:input ref="instance('doc')/eac:control/eac:recordId">
									<xforms:label>Record ID</xforms:label>
									<xforms:alert>The id is required</xforms:alert>
								</xforms:input>
							</div>
						</div>
						<fr:tabview>
							<!--**************************************** IDENTITY **********************************-->
							<fr:tab bind="identity-tab" id="default-tab">
								<fr:label>Identity</fr:label>
								<div class="section">
									<h1>Identity</h1>
									<div class="trigger_container">
										<xforms:trigger appearance="minimal">
											<xforms:label>
												<img src="{$display_path}images/add.gif"/>Name Entry</xforms:label>
											<xforms:insert ev:event="DOMActivate" context="." origin="instance('nameEntry-template')"
												nodeset="if (count(eac:nameEntry) &gt; 0) then eac:nameEntry[last()] else eac:entityType" position="after"/>
										</xforms:trigger>
										<xforms:group ref=".[count(eac:entityId) = 0]">
											<xforms:trigger appearance="minimal">
												<xforms:label>
													<img src="{$display_path}images/add.gif"/>Entity Id</xforms:label>
												<xforms:insert ev:event="DOMActivate" context="." origin="instance('entityId-template')" nodeset="./child::node()[last()]"/>
											</xforms:trigger>
										</xforms:group>
										<xforms:group ref=".[count(eac:descriptiveNote) = 0]">
											<xforms:trigger appearance="minimal">
												<xforms:label>
													<img src="{$display_path}images/add.gif"/>Descriptive Note</xforms:label>
												<xforms:insert ev:event="DOMActivate" context="." origin="instance('descriptiveNote-template')" nodeset="./child::node()[last()]"/>
											</xforms:trigger>
										</xforms:group>
									</div>
									<div>
										<xforms:select1 ref="eac:entityType">
											<xforms:label>Entity Type</xforms:label>
											<xforms:alert>Required</xforms:alert>
											<xforms:item>
												<xforms:label>Select...</xforms:label>
												<xforms:value/>
											</xforms:item>
											<xforms:itemset nodeset="instance('entityType-list')/item">
												<xforms:label ref="."/>
												<xforms:value ref="."/>
											</xforms:itemset>
										</xforms:select1>
									</div>
									<xforms:repeat nodeset="eac:nameEntry">
										<xeac:nameEntry/>
									</xforms:repeat>
									<xforms:group ref="eac:entityId">
										<div>
											<xforms:input ref=".">
												<xforms:label>Entity Id</xforms:label>
												<xforms:alert>Required</xforms:alert>
											</xforms:input>
											<xforms:trigger appearance="minimal">
												<xforms:delete ev:event="DOMActivate" nodeset="."/>
												<xforms:label>
													<xhtml:img src="{$display_path}images/remove.gif"/>
												</xforms:label>
											</xforms:trigger>
										</div>
									</xforms:group>
									<xforms:group ref="eac:descriptiveNote">
										<div>
											<xforms:textarea ref=".">
												<xforms:label>Descriptive Note</xforms:label>
											</xforms:textarea>
											<xforms:trigger appearance="minimal">
												<xforms:delete ev:event="DOMActivate" nodeset="."/>
												<xforms:label>
													<xhtml:img src="{$display_path}images/remove.gif"/>
												</xforms:label>
											</xforms:trigger>
										</div>
									</xforms:group>
								</div>
							</fr:tab>
							<!--**************************************** END IDENTITY **********************************-->
							<fr:tab bind="description-tab">
								<fr:label>Description</fr:label>
								<div class="section">
									<h1>Description</h1>
									<xforms:trigger appearance="minimal">
										<xforms:dispatch target="remove-description" name="fr-show" ev:event="DOMActivate"/>
										<xforms:label>
											<xhtml:img src="{$display_path}images/remove.gif"/>
										</xforms:label>
									</xforms:trigger>
									<fr:alert-dialog id="remove-description">
										<fr:label>Remove Description</fr:label>
										<fr:message>Are you sure you want to remove the Description section?</fr:message>
										<fr:negative-choice>
											<fr:label>No</fr:label>
										</fr:negative-choice>
										<fr:positive-choice>
											<fr:label>Yes</fr:label>
											<xforms:action ev:event="DOMActivate">
												<xforms:delete nodeset="."/>
												<xforms:dispatch targetid="default-tab" name="fr-toggle"/>
											</xforms:action>
										</fr:positive-choice>
									</fr:alert-dialog>
								</div>
							</fr:tab>
							<fr:tab bind="relations-tab" id="temp-tab">
								<fr:label>Relations</fr:label>
								<div class="section">
									<h1>Relations</h1>
									<xforms:trigger appearance="minimal">
										<xforms:dispatch target="remove-relations" name="fr-show" ev:event="DOMActivate"/>
										<xforms:label>
											<xhtml:img src="{$display_path}images/remove.gif"/>
										</xforms:label>
									</xforms:trigger>
									<fr:alert-dialog id="remove-relations">
										<fr:label>Remove Relations</fr:label>
										<fr:message>Are you sure you want to remove the Relations section?</fr:message>
										<fr:negative-choice>
											<fr:label>No</fr:label>
										</fr:negative-choice>
										<fr:positive-choice>
											<fr:label>Yes</fr:label>
											<xforms:action ev:event="DOMActivate">
												<xforms:delete nodeset="."/>
												<xforms:dispatch targetid="default-tab" name="fr-toggle"/>
											</xforms:action>
										</fr:positive-choice>
									</fr:alert-dialog>
									
									<div class="trigger_container">
										<xforms:trigger appearance="minimal">
											<xforms:label>
												<img src="{$display_path}images/add.gif"/>CPF Relation</xforms:label>
											<xforms:insert ev:event="DOMActivate" context="." origin="instance('cpfRelation-template')"/>
										</xforms:trigger>
									</div>
									<xforms:group ref=".[count(eac:cpfRelation) &gt; 0]">
										<div class="subsection">
											<h2>CPF Relations</h2>
											<xforms:repeat nodeset="eac:cpfRelation">
												<xeac:cpfRelation/>
											</xforms:repeat>
										</div>
									</xforms:group>
								</div>
							</fr:tab>
							<!--**************************************** CONTROL **********************************-->
							<fr:tab bind="control-tab">
								<fr:label>Control</fr:label>
								<h1>Control</h1>
								<div>
									<xforms:input ref="eac:maintenanceAgency/eac:agencyName">
										<xforms:label>Agency Name</xforms:label>
										<xforms:alert>Required</xforms:alert>
									</xforms:input>
								</div>
								<div>
									<xforms:select1 ref="eac:maintenanceStatus">
										<xforms:label>Maintenance Status</xforms:label>
										<xforms:alert>Required</xforms:alert>
										<xforms:item>
											<xforms:label>Select...</xforms:label>
											<xforms:value/>
										</xforms:item>
										<xforms:itemset nodeset="instance('maintenanceStatus-list')/item">
											<xforms:label ref="."/>
											<xforms:value ref="."/>
										</xforms:itemset>
									</xforms:select1>
								</div>
								<xforms:group ref="eac:maintenanceHistory">
									<div class="section">
										<h2>Maintenance History</h2>
										<div class="trigger_container">
											<xforms:trigger appearance="minimal">
												<xforms:label>
													<xhtml:img src="{$display_path}images/add.gif"/>Maintenance Event</xforms:label>
												<xforms:action ev:event="DOMActivate">
													<xforms:insert context="." origin="instance('maintenanceEvent-template')" nodeset="./child::node()[last()]"/>
												</xforms:action>
											</xforms:trigger>
										</div>
										<xforms:repeat nodeset="eac:maintenanceEvent">
											<div class="subsection">
												<h3>Maintenance Event</h3>
												<div>
													<xforms:select1 ref="eac:eventType">
														<xforms:label>Event Type</xforms:label>
														<xforms:alert>Required</xforms:alert>
														<xforms:item>
															<xforms:label>Select...</xforms:label>
															<xforms:value/>
														</xforms:item>
														<xforms:itemset nodeset="instance('eventType-list')/item">
															<xforms:label ref="."/>
															<xforms:value ref="."/>
														</xforms:itemset>
													</xforms:select1>
												</div>
												<div>
													<xforms:input ref="eac:eventDateTime/@standardDateTime">
														<xforms:label>Event Date/Time</xforms:label>
														<xforms:alert>Required</xforms:alert>
													</xforms:input>
												</div>
												<div>
													<xforms:select1 ref="eac:agentType">
														<xforms:label>Agent Type</xforms:label>
														<xforms:alert>Required</xforms:alert>
														<xforms:item>
															<xforms:label>Select...</xforms:label>
															<xforms:value/>
														</xforms:item>
														<xforms:itemset nodeset="instance('agentType-list')/item">
															<xforms:label ref="."/>
															<xforms:value ref="."/>
														</xforms:itemset>
													</xforms:select1>
												</div>
												<div>
													<xforms:input ref="eac:agent">
														<xforms:label>Agent</xforms:label>
														<xforms:alert>Required</xforms:alert>
													</xforms:input>
												</div>
											</div>
										</xforms:repeat>
									</div>
								</xforms:group>
							</fr:tab>
							<!--**************************************** END CONTROL **********************************-->
							<fr:tab id="preview">
								<fr:label>XML Preview</fr:label>
								<h1>XML Preview</h1>
								<fr:xforms-inspector id="orbeon-xforms-inspector"/>
							</fr:tab>
						</fr:tabview>
					</div>
				</div>
			</div>
			<!-- footer -->
			<!--<xi:include href="xslt/footer.xml"/>-->
		</div>
	</xhtml:body>
</xhtml:html>

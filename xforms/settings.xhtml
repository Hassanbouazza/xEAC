<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:ev="http://www.w3.org/2001/xml-events"
	xmlns:xxforms="http://orbeon.org/oxf/xml/xforms" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:fr="http://orbeon.org/oxf/xml/form-runner" xmlns:xlink="http://www.w3.org/1999/xlink"
	xmlns:xxi="http://orbeon.org/oxf/xml/xinclude" xmlns:eac="urn:isbn:1-931666-33-4" xmlns:oxf="http://www.orbeon.com/oxf/processors" xmlns:exist="http://exist.sourceforge.net/NS/exist">
	<head>
		<title> Administration</title>
		<link rel="stylesheet" href="/fr/style/bootstrap/css/bootstrap.css" type="text/css"/>
		<link rel="stylesheet" href="/fr/style/form-runner-bootstrap-override.css" type="text/css"/>
		<link rel="stylesheet" href="/config/theme/examples.css" type="text/css" media="all"/>
		<link rel="shortcut icon" href="/ops/images/orbeon-icon-16.ico"/>
		<link rel="icon" href="/ops/images/orbeon-icon-16.png" type="image/png"/>
		<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/3.8.0/build/cssgrids/grids-min.css"/>
		<link rel="stylesheet" type="text/css" href="/apps/xeac/xforms/css/xforms.css"/>

		<xforms:model>
			<xforms:instance id="config" xxforms:exclude-result-prefixes="#all">
				<config xmlns=""/>
			</xforms:instance>

			<xforms:instance id="exist-url" xxforms:exclude-result-prefixes="#all">
				<xi:include href="../exist-url.xml"/>
			</xforms:instance>

			<xforms:instance id="status">
				<status/>
			</xforms:instance>

			<xforms:instance id="flickr-response">
				<rsp xmlns=""/>
			</xforms:instance>

			<xforms:instance id="control-instance">
				<control xmlns="">
					<api-key-accepted/>
					<save-trigger/>
					<collection-name/>
					<error/>
				</control>
			</xforms:instance>

			<xforms:instance id="agencyName-template">
				<item xmlns=""/>
			</xforms:instance>

			<xforms:instance id="relation-template" xxforms:exclude-result-prefixes="#all">
				<relation from="" to="" xmlns=""/>
			</xforms:instance>

			<!-- xquery -->
			<xforms:instance id="eXist-xquery">
				<exist:query xmlns="">
					<exist:text/>
				</exist:query>
			</xforms:instance>

			<xforms:instance id="xqueries">
				<queries xmlns="">
					<query id="gather-relations">declare namespace eac="urn:isbn:1-931666-33-4"; &lt;report> { for $arcrole in distinct-values(collection()//eac:cpfRelation/@xlink:arcrole) order by
						$arcrole return &lt;relation> { $arcrole } &lt;/relation> } &lt;/report> </query>
				</queries>
			</xforms:instance>

			<xforms:instance id="xquery-result">
				<exist:result/>
			</xforms:instance>

			<!-- lists -->
			<xforms:instance id="relations-list" xxforms:exclude-result-prefixes="#all">
				<relations xmlns=""/>
			</xforms:instance>

			<!-- ************ BINDINGS *************** -->
			<xforms:bind nodeset="instance('config')">
				<xforms:bind nodeset="title" required="true()"/>
				<!--<xforms:bind nodeset="banner_text" required="true()"/>-->
				<xforms:bind nodeset="url" required="true()"/>
				<xforms:bind nodeset="solr_published" required="true()"/>
				<xforms:bind nodeset="instances/agencyName-list">
					<xforms:bind nodeset="item" required="true()"/>
				</xforms:bind>
				<xforms:bind nodeset="images">
					<xforms:bind nodeset="thumbnail" required="true()" type="xs:integer"/>
					<xforms:bind nodeset="reference" required="true()" type="xs:integer"/>
				</xforms:bind>
				<xforms:bind nodeset="relationSemantics">
					<xforms:bind nodeset="relation">
						<xforms:bind nodeset="@from" required="true()"/>
						<xforms:bind nodeset="@to" required="true()"/>
					</xforms:bind>
				</xforms:bind>
			</xforms:bind>

			<!-- tabs -->
			<xforms:bind id="settings-tab" nodeset="instance('config')"/>
			<xforms:bind id="relations-tab" nodeset="instance('config')"/>
			<xforms:bind id="advanced-tab" nodeset="instance('config')"/>

			<!-- ****************** SUBMISSIONS ***************** -->
			<!-- Load File -->
			<xforms:submission id="load-config" serialization="none" method="get" action="{instance('exist-url')}xeac/config.xml" xxforms:username="admin" xxforms:password="" replace="instance"
				instance="config">
				<xforms:message ev:event="xforms-submit-error" level="modal">Unable to load configuration file</xforms:message>
			</xforms:submission>

			<!-- Save File -->
			<xforms:submission id="save-config" ref="instance('config')" xxforms:username="admin" xxforms:password="" action="{instance('exist-url')}xeac/config.xml" method="put" replace="none">
				<xforms:setvalue ev:event="xforms-submit-done" ref="instance('status')">Configuration saved.</xforms:setvalue>
				<xforms:message ev:event="xforms-submit-error" level="modal">Error saving configuration file.</xforms:message>
			</xforms:submission>

			<xforms:submission id="xquery-collection" ref="instance('eXist-xquery')" action="{instance('exist-url')}xeac/records" method="post" replace="instance" instance="xquery-result"
				xxforms:username="admin" xxforms:password="">
				<xforms:setvalue ref="instance('control-instance')/error" ev:event="xforms-submit-error">Error querying eXist database.</xforms:setvalue>
			</xforms:submission>

			<xforms:action ev:event="xforms-model-construct-done">
				<xforms:send submission="load-config"/>
			</xforms:action>
		</xforms:model>
	</head>
	<body>
		<div class="yui3-g">
			<div class="yui3-u-1">
				<div class="content">
					<p>
						<a href="../">&lt; Return</a>
					</p>
					<div id="form">
						<xforms:group ref="instance('status')/text()">
							<div class="success">
								<xforms:output ref="instance('status')"/>
							</div>
						</xforms:group>
						<div class="submission">
							<xforms:trigger>
								<xforms:label><img src="/xeac/xforms/images/save.gif" alt="Save"/> Save</xforms:label>
								<xforms:send ev:event="DOMActivate" submission="save-config"/>
							</xforms:trigger>
						</div>
						<h1>Edit Settings</h1>
						<p>Edit titles, URLs, and index text.</p>
						<fr:tabview>
							<fr:tab bind="settings-tab">
								<fr:label>Settings</fr:label>
								<h2>Primary Settings</h2>
								<div class="section">
									<h3>Titles and URLs</h3>
									<div>
										<xforms:input ref="title">
											<xforms:label>Title</xforms:label>
											<xforms:alert>Required</xforms:alert>
										</xforms:input>
										<p>The title of the site to be displayed in all web page titles and citations in PDF files.</p>
									</div>
									<div>
										<xforms:input ref="banner_text">
											<xforms:label>Banner Text</xforms:label>
											<xforms:alert>Required</xforms:alert>
										</xforms:input>
										<p>Appears in the header banner. For more sophisticated control, edit header.xsl.</p>
									</div>
									<div>
										<xforms:input ref="url">
											<xforms:label>URL</xforms:label>
											<xforms:alert>Required</xforms:alert>
										</xforms:input>
										<p>Public URL of the site. Used in citations of and image references in PDF printouts. Changing this to an inactive URL will <b>not</b> break 's core
											functionality, but web forms may be style-less since the Orbeon applications point to this URL for embedding css files.</p>
									</div>
									<!--<div>
										<xforms:textarea ref="google_analytics/script">
										<xforms:label>Google Analytics</xforms:label>
										</xforms:textarea>
										<p>Copy and paste the javascript code between <b>&lt;script type="text/javascript"&gt;&lt;/script&gt;</b> provided by Google.</p>
										</div>-->
								</div>
								<div class="section">
									<h2>API Keys</h2>
									<!--<h3>flickr</h3>
										<xforms:group ref=".[instance('flickr-response')/@stat='fail' and string-length(flickr_api_key) &gt; 0]">
										<div class="ui-widget">
										<div class="ui-state-error ui-corner-all">
										<p>
										<span class="ui-icon ui-icon-alert" style="float: left; margin-right: 0.3em;"/>
										<strong>Alert:</strong>
										<xforms:output ref="instance('flickr-response')/err/@msg"/>
										</p>
										</div>
										</div>
										</xforms:group>
										<div>
										<xforms:input ref="flickr_api_key" incremental="true">
										<xforms:label>Key</xforms:label>
										<xforms:send submission="test-for-echo" ev:event="xforms-value-changed"/>
										</xforms:input>
										<p>A <a href="http://www.flickr.com/services/api/misc.api_keys.html">flickr API key</a> is required in order to take advantage of flickr image linking in
										Numishare.</p>
										</div>-->
									<div class="subsection">
										<h3>geonames</h3>
										<div>
											<xforms:input ref="geonames_api_key" incremental="true">
												<xforms:label>Key</xforms:label>
											</xforms:input>
											<p>A <a href="http://www.geonames.org/export/web-services.html">geonames API key</a> is required in order to link geographical places to geonames ids.</p>
										</div>
									</div>
								</div>
								<div class="section">
									<xforms:group ref="instances/agencyName-list">
										<h2>Agency Names</h2>
										<xforms:trigger appearance="minimal">
											<xforms:label>
												<img src="/xeac/xforms/images/add.gif"/>Agency</xforms:label>
											<xforms:insert ev:event="DOMActivate" context="." nodeset="./child::node()[last()]" origin="instance('agencyName-template')"/>
										</xforms:trigger>
										<xforms:repeat nodeset="item">
											<div>
												<xforms:input ref=".">
													<xforms:label>Agency <xforms:output value="if(@default='true') then '(default)' else ''"/>
													</xforms:label>
													<xforms:alert>Required</xforms:alert>
												</xforms:input>
												<xforms:group ref=".[not(@default='true')]">
													<xforms:trigger appearance="minimal">
														<xforms:delete ev:event="DOMActivate" nodeset="."/>
														<xforms:label>
															<img src="/xeac/xforms/images/remove.gif"/>
														</xforms:label>
													</xforms:trigger>
												</xforms:group>
											</div>
										</xforms:repeat>
									</xforms:group>
								</div>
							</fr:tab>
							<fr:tab bind="relations-tab">
								<fr:label>Semantic Relationships</fr:label>
								<div class="section">
									<h2>Semantic Relationships</h2>
									<span class="add">
										<xforms:trigger appearance="minimal">
											<xforms:label><img src="/xeac/xforms/images/add.gif"/>Import</xforms:label>
											<xforms:action ev:event="DOMActivate">
												<xforms:setvalue ref="instance('eXist-xquery')/exist:text" value="instance('xqueries')/query[@id='gather-relations']"/>
												<xforms:send submission="xquery-collection"/>
												<xforms:insert context="instance('relations-list')" origin="instance('xquery-result')//relation"/>
											</xforms:action>
										</xforms:trigger>
									</span>
									<xforms:group ref="instance('relations-list')[count(//relation) &gt; 0]">
										<div class="subsection">
											<h3>Available Relationships</h3>
											<p>The following semantic relationships are already employed in this EAC-CPF collection.</p>
											<xforms:repeat nodeset="relation">
												<xforms:var name="val" select="text()"/>
												<div>
													<xforms:output ref=".">
														<xforms:label>Relation</xforms:label>
													</xforms:output>
													<xforms:group ref=".[not(instance('config')/relationSemantics/relation/@from = $val)]">
														<xforms:trigger appearance="minimal">
															<xforms:label><img src="/xeac/xforms/images/add.gif"/>Add</xforms:label>
															<xforms:action ev:event="DOMActivate">
																<xforms:insert context="instance('config')/relationSemantics" nodeset="./child::node()[last()]" origin="instance('relation-template')"/>
																<xforms:setvalue ref="instance('config')/relationSemantics/relation[last()]/@from" value="$val"/>
																<!--<xforms:setvalue ref="instance('config')/relationSemantics/relation[last()]/@to" value="$val"/>-->
															</xforms:action>
														</xforms:trigger>
													</xforms:group>
												</div>
											</xforms:repeat>
										</div>
									</xforms:group>
									<xforms:group ref="relationSemantics">
										<div class="subsection">
											<h3>Controlled Template</h3>
											<span class="add">
												<xforms:trigger appearance="minimal">
													<xforms:label><img src="/xeac/xforms/images/add.gif"/>Add New</xforms:label>
													<xforms:action ev:event="DOMActivate">
														<xforms:insert context="instance('config')/relationSemantics" nodeset="./child::node()[last()]" origin="instance('relation-template')"/>
													</xforms:action>
												</xforms:trigger>
											</span>
											<xforms:group ref=".[count(relation) &gt; 0]">
												<table>
													<thead>
														<tr>
															<th>Relation</th>
															<th>Inverse</th>
															<th>Delete</th>
														</tr>
													</thead>
													<tbody>
														<xforms:repeat nodeset="relation">
															<tr>
																<td>
																	<xforms:input ref="@from">
																		<xforms:alert>Required</xforms:alert>																		
																		<xforms:setvalue ref="parent::node()/@to" value="parent::node()/@from" ev:event="xforms-value-changed"/>
																	</xforms:input>													
																</td>
																<td>
																	<xforms:select1 ref="@to">																	
																		<xforms:itemset nodeset="instance('config')/relationSemantics/relation">
																			<xforms:label ref="@from"/>
																			<xforms:value ref="@from"/>
																		</xforms:itemset>
																		<xforms:alert>Required</xforms:alert>
																	</xforms:select1>
																</td>
																<td>
																	<xforms:trigger appearance="minimal">
																		<xforms:delete ev:event="DOMActivate" nodeset="."/>
																		<xforms:label>
																			<img src="/xeac/xforms/images/remove.gif"/>
																		</xforms:label>
																	</xforms:trigger>
																</td>
															</tr>
														</xforms:repeat>
													</tbody>
												</table>
											</xforms:group>								
										</div>
									</xforms:group>
								</div>
							</fr:tab>
							<fr:tab bind="advanced-tab">
								<fr:label>Advanced</fr:label>
								<div class="section">
									<h2>Solr URLs</h2>
									<p>
										<b>Only change these options if Orbeon is run on a separate server.</b>
									</p>
									<p>Changing these options to an inactive URL could break public coin display and web form functionality.</p>
									<div>
										<xforms:input ref="solr_published">
											<xforms:label>Published Documents</xforms:label>
											<xforms:alert>Required</xforms:alert>
										</xforms:input>
									</div>
									<div>
										<xforms:input ref="solr_all">
											<xforms:label>All Documents</xforms:label>
											<xforms:alert>Required</xforms:alert>
										</xforms:input>
									</div>
								</div>
							</fr:tab>
						</fr:tabview>
						<!--<fr:xforms-inspector id="orbeon-xforms-inspector"/>-->
					</div>
				</div>
			</div>
		</div>
	</body>

</html>
